library(stringr)
library(dplyr)


taipei_accidents_zh <- taipei_accidents_df |>
  
  # convert codes to values
  mutate(
         # convert 民國to 西元
         發生年度 =  發生年度 + 1911,
         發生日期 = as.Date(paste(發生年度, 發生月, 發生日, sep = "-")),
         區序 = str_remove(區序, "\\d+"),
         車種 = case_match(車種,
                         "A01" ~ "大客車 - 公營公車",
                         "A02" ~ "大客車 - 民營公車",
                         "A03" ~ "大客車 - 公營客運",
                         "A04" ~ "大客車 - 民營客運",
                         "A05" ~ "大客車 - 遊覽車",
                         "A06" ~ "大客車 - 自用大客車",
                         
                         "A11" ~ "大貨車 - 營業用",
                         "A12" ~ "大貨車 - 自用",
                         
                         "A21" ~ "全聯結車 - 營業用",
                         "A22" ~ "全聯結車 - 自用",
                         
                         "A31" ~ "半聯結車 - 營業用",
                         "A32" ~ "半聯結車 - 自用",
                         
                         "A41" ~ "曳引車 - 營業用",
                         "A42" ~ "曳引車 - 自用",
                         
                         "B01" ~ "小客車 - 計程車",
                         "B02" ~ "小客車 - 租賃車",
                         "B03" ~ "小客車 - 自用",
                         
                         "B11" ~ "小貨車(含客、貨 兩用) - 營業用",
                         "B12" ~ "小貨車(含客、貨 兩用) - 自用",
                         "B13" ~ "小貨車(含客、貨 兩用) - 租賃小貨車",
                         
                         "C01" ~ "機車 - 大型重型1(550C.C.以上)",
                         "C02" ~ "機車 - 大型重型2(250-550C.C.)",
                         "C03" ~ "機車 - 普通重型",
                         "C04" ~ "機車 - 普通輕型",
                         "C05" ~ "機車 - 小型輕型",
                         
                         "D01" ~ "軍車 - 大客車",
                         "D02" ~ "軍車 - 載重車",
                         "D03" ~ "軍車 - 小型車",
                         
                         "E01" ~ "特種車 - 救護車",
                         "E02" ~ "特種車 - 消防車",
                         "E03" ~ "特種車 - 警備車",
                         "E04" ~ "特種車 - 工程車",
                         "E05" ~ "特種車 - 其他特種車",
                         
                         "F01" ~ "慢車 - 腳踏自行車",
                         "F02" ~ "慢車 - 電動輔助自行車",
                         "F03" ~ "慢車 - 電動自行車/微型電動二輪車",
                         "F04" ~ "慢車 - 人力車",
                         "F05" ~ "慢車 - 獸力車",
                         "F06" ~ "慢車 - 其他慢車",
                         "F07" ~ "慢車 - 個人行動運具",
                         
                         "G01" ~ "其他車 - 拼裝車",
                         "G02" ~ "其他車 - 農耕用車(或機械)",
                         "G03" ~ "其他車 - 動力機械",
                         "G04" ~ "其他車 - 拖車(架)",
                         "G05" ~ "其他車 - 火車",
                         "G06" ~ "其他車 - 其他車",
                         
                         "H01" ~ "人 - 行人",
                         "H02" ~ "人 - 乘客",
                         "H03" ~ "人 - 其他人",
                         "H04" ~ "人 - 輔助代步器材",
                         .default = 車種),
         
         
         
         性別 = case_match(性別,
                         1 ~ "男",
                         2 ~ "女",
                         3 ~ "無或物(動物、堆置物)",
                         4 ~ "肇事逃逸尚未查獲",
                         5 ~ "無人駕駛自動車"),
         
         
         
         受傷程度 = case_match(受傷程度,
                       1 ~ "24小時內死亡",
                       2 ~ "受傷",
                       3 ~ "未受傷",
                       4 ~ "不明",
                       5 ~ "2-30日內死亡"),
         
         
         天候 = case_match(天候,
                         1 ~ "暴雨",
                         2 ~ "強風",
                         3 ~ "風沙",
                         4 ~ "霧或煙",
                         5 ~ "雪",
                         6 ~ "雨",
                         7 ~ "陰",
                         8 ~ "晴",
                         9 ~ "風"),
         
         # Taipei Changed their form on July 1st, 2023 and what the categories
         # mean changed then too
         道路型態 = ifelse(發生日期 > "2023-07-01", 
                          case_match(道路型態,
                           3 ~ "三岔路",
                           4 ~ "四岔路",
                           5 ~ "多岔路", 
                           6 ~ "隧道",
                           7 ~ "地下道",
                           8 ~ "橋樑",
                           9 ~ "涵洞",
                           10 ~ "高架道路",
                           11 ~ "彎曲路及附近",
                           12 ~ "坡路",
                           13 ~ "巷弄",
                           14 ~ "直路",
                          # 15 ~ "廣場",
                         #  16 ~ "休息站或服務區",
                          # 17 ~ "輕軌共用道路",
                           18 ~ "圓環",
                           19 ~ "廣場",
                           20 ~ "休息站或服務區",
                           21 ~ "輕軌共用道路",
                           22 ~ "其他",
                           .default = as.character(道路型態)
                           ),
                       
                       case_match(道路型態,
                                  3 ~ "三岔路",
                                  4 ~ "四岔路",
                                  5 ~ "多岔路", 
                                  6 ~ "隧道",
                                  7 ~ "地下道",
                                  8 ~ "橋樑",
                                  9 ~ "涵洞",
                                  10 ~ "高架道路",
                                  11 ~ "彎曲路及附近",
                                  12 ~ "坡路",
                                  13 ~ "巷弄",
                                  14 ~ "直路",
                                  15 ~ "其他",
                                  16 ~ "圓環",
                                  17 ~ "廣場",
                                  .default = as.character(道路型態)
                       )),
         
         
         
         事故位置 = case_match(事故位置, 
                           1 ~ "交岔路口內",
                           2 ~ "交岔口附近",
                           3 ~ "機慢車待轉區",
                           4 ~ "機慢車停等區", 
                           5 ~ "交通島(含槽化線)",
                           6 ~ "迴轉道",
                           7 ~ "快車道",
                           8 ~ "慢車道", 
                           9 ~ "一般車道(未劃分快慢車道)",
                           10 ~ "公車專用道",
                           11 ~ "機車專用道",
                           12 ~ "機車優先道",
                           13 ~ "路肩、路緣",
                           14 ~ "加速車道",
                           15 ~ "減速車道",
                           16 ~ "直線匝道",
                           17 ~ "環道匝道",
                           18 ~ "行人穿越道",
                           19 ~ "行人穿越道附近",
                           20 ~ "人行道",
                           21 ~ "收費站附近",
                           22 ~ "其他",
                           23 ~ "自行車專用道",
                           24 ~ "人行道標線",
                           25 ~ "騎樓", 
                           .default = as.character(道路型態)
                           
                           ),
         
         光線 = case_match(光線,
                         1 ~ "日間自然光線",
                         2 ~ "晨或暮光",
                         3 ~ "夜間(隧道地下道涵洞)有照明",
                         4 ~ "夜間(隧道地下道涵洞)無照明",
                         5 ~ "有照明且開啟",
                         6 ~ "有照明未開啟或障",
                         7 ~ "無照明", 
                         .default = as.character(光線)),
         
         
         道路照明設備 = case_match(道路照明設備,
                         1 ~ "日間自然光線",
                         2 ~ "晨或暮光",
                         3 ~ "夜間(隧道地下道涵洞)有照明",
                         4 ~ "夜間(隧道地下道涵洞)無照明",
                         5 ~ "有照明且開啟",
                         6 ~ "有照明未開啟或障",
                         7 ~ "無照明", 
                         .default = as.character(道路照明設備)),
         
         
        道路類別 = case_match(道路類別,
                          1 ~ "國道",
                          2 ~ "省道",
                          3 ~ "縣道",
                          4 ~ "鄉道",
                          5 ~ "市區道路",
                          6 ~ "村里道路",
                          7 ~ "專用道路",
                          8 ~ "其他",
                          9 ~ "快速(公)道路", 
                          .default = as.character(道路類別)),
        
        
        路面鋪裝 = case_match(路面狀況1,
                          1 ~ "柏油",
                          2 ~ "水泥",
                          3 ~ "碎石", 
                          4 ~ "其他鋪裝",
                          5 ~ "無鋪裝"),
        
        
        路面狀態  = case_match(路面狀況2,
                          1 ~ "冰雪",
                          2 ~ "油滑",
                          3 ~ "泥濘", 
                          4 ~ "濕潤",
                          5 ~ "乾燥"),
        
        
        路面缺陷  = case_match(路面狀況3,
                           1 ~ "路面鬆軟",
                           2 ~ "突出(高低)不平",
                           3 ~ "有坑洞", 
                           4 ~ "無缺陷",
                           5 ~ "隆起或凹陷不平"),
        
        
        道路障礙_障礙物 = case_match(道路障礙1,
                          1 ~ "道路工事(程)中",
                          2 ~ "有堆積物",
                          3 ~ "路上有停車", 
                          4 ~ "其他障礙物",
                          5 ~ "無障礙物",
                          6 ~ "攤位、棚架"),
        
        
        道路障礙_視距 = case_match(道路障礙2,
                           1 ~ "彎道",
                           2 ~ "坡道",
                           3 ~ "建築物", 
                           4 ~ "樹木、農作物",
                           5 ~ "路上停放車輛", 
                           6 ~ "其他",
                           7 ~ "良好",
                           8 ~ "有遮蔽物 - 建築物",
                           9 ~ "有遮蔽物 - 樹木、農作物",
                           10 ~ "有遮蔽物 - 路上停放車輛",
                           11 ~ "有遮蔽物 - 施工圍籬",
                           12 ~ "有遮蔽物 - 其他",
                           13 ~ "無遮蔽物 - 良好"),
        
        
        
        號誌種類 = case_match(號誌1,
                              1 ~ "行車管制號誌",
                              2 ~ "行車管制號誌(附設行人專用號誌)",
                              3 ~ "閃光號誌", 
                              4 ~ "無號誌"),
        
        
        號誌動作 = case_match(號誌2,
                          1 ~ "正常",
                          2 ~ "不正常",
                          3 ~ "無動作", 
                          4 ~ "無號誌"),
        
        
        車道劃分_分向 = case_match(`車道劃分-分向`,
                          1 ~ "中央分向島 - 寬式(50 公分以上)",
                          2 ~ "中央分向島 - 窄式附柵欄",
                          3 ~ "中央分向島 - 窄式無柵欄", 
                          4 ~ "雙向禁止超車線 - 附標記",
                          5 ~ "雙向禁止超車線 - 無標記",
                          6 ~ "單向禁止超車線 - 附標記",
                          7 ~ "單向禁止超車線 - 無標記",
                          8 ~ "行車分向線 - 附標記",
                          9 ~ "行車分向線 - 無標記", 
                          10 ~ "無分向設施"),
        
        
        車道劃分_快車道或一般車道間 = case_match(`車道劃分-分道1`,
                             1 ~ "禁止變換車道線(附標記)",
                             2 ~ "禁止變換車道線(無標記)",
                             3 ~ "車道線(附標記)", 
                             4 ~ "車道線(無標記)",
                             5 ~ "未繪設車道線"),
        
        
        車道劃分_快慢車道間 = case_match(`車道劃分-分道2`,
                                    1 ~ "寬式快慢車道分隔島(50 公分以上)",
                                    2 ~ "窄式快慢車道分隔島(附柵欄)",
                                    3 ~ "窄式快慢車道分隔島(無柵欄)", 
                                    4 ~ "快慢車道分隔線",
                                    5 ~ "未繪設快慢車道分隔線"),
        
        
        車道劃分_路面邊線 = case_match(`車道劃分-分道3`,
                                1 ~ "有",
                                2 ~ "無"),
        
        
        
        
        事故類型及型態 = case_match(事故類型及型態, 
                          1 ~ "人與車 - 對向通行中",
                          2 ~ "人與車 - 同向通行中",
                          3 ~ "人與車 - 穿越道路中",
                          4 ~ "人與車 - 在路上嬉戲", 
                          5 ~ "人與車 - 在路上作業中",
                          6 ~ "人與車 - 衝進路中",
                          7 ~ "人與車 - 從停車後(或中)穿出",
                          8 ~ "人與車 - 佇立路邊(外)", 
                          9 ~ "人與車 - 其他",
                          10 ~ "車與車 - 對撞",
                          11 ~ "車與車 - 對向擦撞",
                          12 ~ "車與車 - 同向擦撞",
                          13 ~ "車與車 - 追撞",
                          14 ~ "車與車 - 倒車撞",
                          15 ~ "車與車 - 路口交岔撞",
                          16 ~ "車與車 - 側撞",
                          17 ~ "車與車 - 其他",
                          18 ~ "車輛本身 - 路上翻車、摔倒",
                          19 ~ "車輛本身 - 衝出路外",
                          20 ~ "車輛本身 - 撞護欄(樁)",
                          21 ~ "車輛本身 - 撞號誌、標誌桿",
                          22 ~ "車輛本身 - 撞收費亭",
                          23 ~ "車輛本身 - 撞交通島",
                          24 ~ "車輛本身 - 撞非固定設施",
                          25 ~ "車輛本身 - 撞橋梁、建築物", 
                          26 ~ "車輛本身 - 撞路樹、電桿",
                          27 ~ "車輛本身 - 撞動物",
                          28 ~ "車輛本身 - 撞工程施工",
                          29 ~ "車輛本身 - 其他",
                          35 ~ "車輛本身 - 撞橋樑(橋墩)", 
                          36 ~ "車輛本身 - 撞建築物", 
                          37 ~ "車輛本身 - 撞路樹",
                          38 ~ "車輛本身 - 撞電桿",
                          .default = as.character(道路型態)),
        
        
        主要傷處 = case_match(主要傷處,
                          1 ~ "頭部",
                          2 ~ "頸部",
                          3 ~ "胸部",
                          4 ~ "腹部", 
                          5 ~ "腰部",
                          6 ~ "背脊部",
                          7 ~ "手(腕)部",
                          8 ~ "腿(腳)部", 
                          9 ~ "多數傷",
                          10 ~ "無",
                          11 ~ "不明"),
        
        
        
        保護裝置 = case_match(保護裝置,
                          1 ~ "戴安全帽或繫安全帶(使用幼童安全椅)",
                          2 ~ "未戴安全帽或未繫安全帶(未使用幼童安全椅)",
                          3 ~ "不明",
                          4 ~ "其他(無需使用保護裝備之人)/(行人、慢車駕駛人)", 
                          5 ~ "戴半罩式安全帽",
                          6 ~ "戴非半罩式安全帽",
                          7 ~ "有繫安全帶(使用幼童安全椅)"),
        
        安全帽= case_match(安全帽,
                          1 ~ "戴安全帽或繫安全帶(使用幼童安全椅)",
                          2 ~ "未戴安全帽或未繫安全帶(未使用幼童安全椅)",
                          3 ~ "不明",
                          4 ~ "其他(無需使用保護裝備之人)/(行人、慢車駕駛人)", 
                          5 ~ "戴半罩式安全帽",
                          6 ~ "戴非半罩式安全帽",
                          7 ~ "有繫安全帶(使用幼童安全椅)"),
        
        
        
        行動電話 = case_match(行動電話,
                          1 ~ "未使用",
                          2 ~ "使用手持或有礙駕駛安全",
                          3 ~ "使用免持或未有礙駕駛安全",
                          4 ~ "不明", 
                          5 ~ "非汽(機)車駕駛人"),
        
        
        
        車輛用途 = case_match(車輛用途,
                          1 ~ "砂石車",
                          2 ~ "幼童專用車",
                          3 ~ "校車",
                          4 ~ "身障特製車", 
                          5 ~ "教練車",
                          6 ~ "裝載危險物品車",
                          7 ~ "其他",
                          8 ~ "非駕駛人及乘客"), 
        
        
        當事者行動狀態 = case_match(當事者行動狀態, 
                             1 ~ "車的狀態 - 起步",
                             2 ~ "車的狀態 - 倒車",
                             3 ~ "車的狀態 - 停車操作中",
                             4 ~ "車的狀態 - 超車(含超越)", 
                             5 ~ "車的狀態 - 左轉彎",
                             6 ~ "車的狀態 - 轉彎",
                             7 ~ "車的狀態 - 向左變換車道",
                             8 ~ "車的狀態 - 向右變換車道", 
                             9 ~ "車的狀態 - 向前直行中",
                             10 ~ "車的狀態 - 插入行列",
                             11 ~ "車的狀態 - 轉或橫越道路中",
                             12 ~ "車的狀態 - 減速或急停止",
                             13 ~ "車的狀態 - 靜止(引擎熄火)",
                             14 ~ "車的狀態 - 停等(引擎未熄火)",
                             15 ~ "車的狀態 - 其他",
                             16 ~ "人的狀態 - 步行",
                             17 ~ "人的狀態 - 靜立 (止)",
                             18 ~ "人的狀態 - 奔跑",
                             19 ~ "人的狀態 - 上、下車",
                             20 ~ "人的狀態 - 其他",
                             21 ~ "不明"),
        
        
        
        駕駛資格情形 = case_match(駕駛資格情形,
                          1 ~ "有正常駕照",
                          2 ~ "無照(未達考照年齡)",
                          3 ~ "無照(已達考照年齡)",
                          4 ~ "越級駕駛", 
                          5 ~ "照被吊扣",
                          6 ~ "駕照被吊(註)銷",
                          7 ~ "不明",
                          8 ~ "無需駕照之人/非汽(機)車駕駛人"), 
        
        
        
        
        
        駕駛執照種類 = case_match(駕駛執照種類, 
                             1 ~ "職業駕照 - 聯結車",
                             2 ~ "職業駕照 - 大客車",
                             3 ~ "職業駕照 - 大貨車",
                             4 ~ "職業駕照 - 小型車", 
                             5 ~ "普通駕照 - 聯結車",
                             6 ~ "普通駕照 - 大客車",
                             7 ~ "普通駕照 - 大貨車",
                             8 ~ "普通駕照 - 小型車", 
                             9 ~ "機車駕照 - 大型重型",
                             10 ~ "機車駕照 - 普通重型",
                             11 ~ "機車駕照 - 輕型",
                             12 ~ "軍用駕照 - 大客車",
                             13 ~ "軍用駕照 - 載重車",
                             14 ~ "軍用駕照 - 小型車",
                             15 ~ "其他 - 國際(外國)駕照",
                             16 ~ "其他 - 其他駕照(證)",
                             17 ~ "其他 - 學習駕駛證",
                             18 ~ "其他 - 無駕駛執照",
                             19 ~ "其他 - 不明",
                             20 ~ "其他 - 無需駕照之人/非汽(機)車駕駛人",
                             21 ~ "機車駕照 - 小型輕型"),
        
        
        
        
        飲酒情形 = case_match(飲酒情形, 
                            1 ~ "經觀察未飲酒",
                            2 ~ "經檢測無酒精反應",
                            3 ~ "呼氣未滿 0.15 mg/L或血液檢測未滿 0.03%",
                            4 ~ "呼氣達0.15以上未滿0.25 mg/L或血液 0.03%以上未滿0.05%", 
                            5 ~ "呼氣達0.25以上未滿0.40 mg/L或血液 0.05%以上未滿0.08%",
                            6 ~ "呼氣達0.4以上未滿0.55mg/L或血液達 0.08%以上未滿0.11%",
                            7 ~ "呼氣達0.55以上未滿0.80 mg/L或血液 0.11%以上未滿0.16%",
                            8 ~ "呼氣檢測 0.80 mg/L以上或血液檢測 0.16%以上", 
                            9 ~ "駕駛人無法檢測",
                            10 ~ "非駕駛人未檢測",
                            11 ~ "駕駛人不明"),
        
        
        
        車輛撞擊部位1 = case_match(車輛撞擊部位1, 
                          1 ~ "汽車 - 前車頭",
                          2 ~ "汽車 - 右側車身",
                          3 ~ "汽車 - 後車尾",
                          4 ~ "汽車 - 左側車身", 
                          5 ~ "汽車 - 右前車頭(身)",
                          6 ~ "汽車 - 右後車尾(身)",
                          7 ~ "汽車 - 左後車尾(身)",
                          8 ~ "汽車 - 左前車頭(身)", 
                          9 ~ "汽車 - 車頂",
                          10 ~ "汽車 - 車底",
                          11 ~ "機車與自行車 - 前車頭",
                          12 ~ "機車與自行車 - 右側車身",
                          13 ~ "機車與自行車 - 後車尾", 
                          14 ~ "機車與自行車 - 左側車身",
                          15 ~ "其他 - 不明",
                          16 ~ "其他 - 無撞擊",
                          17 ~ "其他 - 非汽、機及自行車"),
        
        
        
        車輛撞擊部位2 = case_match(車輛撞擊部位2, 
                             "1" ~ "汽車 - 前車頭",
                             "2" ~ "汽車 - 右側車身",
                             "3" ~ "汽車 - 後車尾",
                             "4" ~ "汽車 - 左側車身", 
                             "5" ~ "汽車 - 右前車頭(身)",
                             "6" ~ "汽車 - 右後車尾(身)",
                             "7" ~ "汽車 - 左後車尾(身)",
                             "8" ~ "汽車 - 左前車頭(身)", 
                             "9" ~ "汽車 - 車頂",
                             "10" ~ "汽車 - 車底",
                             "11" ~ "機車與自行車 - 前車頭",
                             "12" ~ "機車與自行車 - 右側車身",
                             "13" ~ "機車與自行車 - 後車尾", 
                             "14" ~ "機車與自行車 - 左側車身",
                             "15" ~ "其他 - 不明",
                             "16" ~ "其他 - 無撞擊",
                             "17" ~ "其他 - 非汽、機及自行車"),
        
        
        
        # chatgpt generated...need to double check:
        肇因碼_個別 = case_match(`肇因碼-個別`,
                              1 ~ "駕駛者 - 違規超車",
                              2 ~ "駕駛者 - 爭(搶)道行駛",
                              68 ~ "駕駛者 - 危險駕駛",
                              4 ~ "駕駛者 - 逆向行駛",
                              13 ~ "駕駛者 - 超速駕駛",
                              14 ~ "駕駛者 - 未依規定減速",
                              16 ~ "駕駛者 - 未保持行車安全距離",
                              17 ~ "駕駛者 - 未保持行車安全間隔",
                              69 ~ "駕駛者 - 未遵守依法令授權交通指揮人員之指揮",
                              70 ~ "駕駛者 - 車輛未依規定暫停讓行人先行",
                              71 ~ "駕駛者 - 有號誌路口，轉彎車未讓直行車先行",
                              72 ~ "駕駛者 - 無號誌路口，支線道未讓幹線道先行",
                              73 ~ "駕駛者 - 無號誌路口，少線道未讓多線道先行",
                              74 ~ "駕駛者 - 無號誌路口，轉彎車未讓直行車先行",
                              75 ~ "駕駛者 - 無號誌路口，左方車未讓右方車先行",
                              76 ~ "駕駛者 - 山路會車，靠山壁車未讓外緣車先行",
                              77 ~ "駕駛者 - 峻狹坡路會車，下坡車未讓上坡車先行",
                              78 ~ "駕駛者 - 行經圓環未依規定讓車",
                              79 ~ "駕駛者 - 未依規定避讓消防、救護、警備、工程救險車、毒性化學物質災害事故應變車等執行緊急任務車",
                              80 ~ "駕駛者 - 其他未依規定讓車",
                              81 ~ "駕駛者 - 闖紅燈直行",
                              82 ~ "駕駛者 - 闖紅燈右轉",
                              83 ~ "駕駛者 - 闖紅燈左轉（或迴轉）",
                              84 ~ "駕駛者 - 違反閃光號誌",
                              85 ~ "駕駛者 - 違反其他號誌",
                              86 ~ "駕駛者 - 違反遵行方向標誌（線）",
                              87 ~ "駕駛者 - 違反車輛專用標誌（線）",
                              88 ~ "駕駛者 - 違反行人專用標誌（線）",
                              89 ~ "駕駛者 - 違反禁止進入標誌",
                              90 ~ "駕駛者 - 違反禁止各種車輛進入標誌",
                              91 ~ "駕駛者 - 違反禁止會車標誌",
                              92 ~ "駕駛者 - 違反禁止迴轉或迴車標誌",
                              93 ~ "駕駛者 - 違反車輛改道標誌",
                              94 ~ "駕駛者 - 違反禁止超車標誌（線）",
                              95 ~ "駕駛者 - 違反禁止變換車道標線",
                              96 ~ "駕駛者 - 違反二段式左（右）轉標誌（線）",
                              97 ~ "駕駛者 - 違反禁行車種標誌（字）",
                              98 ~ "駕駛者 - 違反禁止左轉、右轉標誌",
                              99 ~ "駕駛者 - 違反其他標誌（線）禁制",
                              100 ~ "駕駛者 - 變換車道不當",
                              5 ~ "駕駛者 - 未靠右行駛",
                              101 ~ "駕駛者 - 方向不定（不包括危險駕車）",
                              102 ~ "駕駛者 - 閃避不當（慎）",
                              103 ~ "駕駛者 - 多車道迴轉，未先駛入內側車道",
                              10 ~ "駕駛者 - 迴轉未依規定",
                              11 ~ "駕駛者 - 橫越道路不慎",
                              9 ~ "駕駛者 - 右轉彎未依規定",
                              8 ~ "駕駛者 - 左轉彎未依規定",
                              12 ~ "駕駛者 - 倒車未依規定",
                              18 ~ "駕駛者 - 停車操作時未注意安全",
                              19 ~ "駕駛者 - 起步時未注意安全",
                              20 ~ "駕駛者 - 吸食違禁物駕駛",
                              21 ~ "駕駛者 - 酒醉（後）駕駛",
                              22 ~ "駕駛者 - 患病或服用藥物（疲勞）駕駛",
                              104 ~ "駕駛者 - 打瞌睡或疲勞駕駛（包括連續駕車8小時）",
                              105 ~ "駕駛者 - 飲食、抽（點）菸、拿（撿）物品分心駕駛",
                              106 ~ "駕駛者 - 乘客、車上動（生）物干擾分心駕駛",
                              107 ~ "駕駛者 - 觀看其他事故、活動、道路環境或車外資訊分心駕駛",
                              108 ~ "駕駛者 - 恍神、緊張、心不在焉分心駕駛",
                              109 ~ "駕駛者 - 使用車輛自動駕駛或先進駕駛輔助系統設備（裝置）不符規定",
                              110 ~ "駕駛者 - 操作、觀看行車輔助或娛樂性顯示設備",
                              111 ~ "駕駛者 - 使用手持行動電話",
                              24 ~ "駕駛者 - 搶（闖）越平交道",
                              112 ~ "駕駛者 - 未保持平交道淨空",
                              
                              27 ~ "燈光 - 未依規定使用燈光",
                              28 ~ "燈光 - 暗處停車無燈光、標識",
                              29 ~ "燈光 - 夜間行駛無燈光設備",
                              
                              30 ~ "裝載 - 裝載貨物不穩妥",
                              31 ~ "裝載 - 載運貨物超重",
                              32 ~ "裝載 - 超載人員",
                              33 ~ "裝載 - 載運貨物超長、寬、高",
                              34 ~ "裝載 - 裝卸貨物不當",
                              35 ~ "裝載 - 裝載未盡安全措施",
                              36 ~ "裝載 - 未待乘客安全上下而開車",
                              37 ~ "裝載 - 其他裝載不當",
                              
                              40 ~ "其他 - 開啟或關閉車門不當",
                              38 ~ "其他 - 違規（臨時）停車",
                              113 ~ "其他 - 車輛未停妥滑動致生事故",
                              39 ~ "其他 - 車輛拋錨未採安全措施",
                              114 ~ "其他 - 發生事故後未採取安全措施",
                              115 ~ "其他 - 被車輛輾壓之不明物體彈飛",
                              116 ~ "其他 - 車輛或機械操作不當（慎）",
                              117 ~ "其他 - 因光線、視線遮蔽致生事故",
                              42 ~ "其他 - 其他不當駕車行為",
                              118 ~ "其他 - 相關跡證不足且無具體影像畫面，當事人各執一詞，經分析後無法釐清肇事原因",
                              119 ~ "其他 - 肇事逃逸未查獲，無法查明肇因",
                              
                              44 ~ "無（車輛駕駛者因素） - 尚未發現肇事因素",
                              
                              45 ~ "機件 - 煞車失靈或故障",
                              46 ~ "機件 - 方向操縱系統故障",
                              48 ~ "機件 - 車輪脫落或輪胎爆裂",
                              49 ~ "機件 - 車輛零件脫落",
                              47 ~ "機件 - 燈光系統故障",
                              120 ~ "機件 - 車輛附屬機具未盡安全措施",
                              50 ~ "機件 - 其他機件失靈或故障",
                              
                              121 ~ "非駕駛者 - 未依標誌或標線穿越道路",
                              122 ~ "非駕駛者 - 未依號誌或手勢指揮（示）穿越道路",
                              123 ~ "非駕駛者 - 未依規定行走地下道、天橋穿越道路",
                              53 ~ "非駕駛者 - 穿越道路未注意左右來車",
                              54 ~ "非駕駛者 - 在道路上嬉戲或奔走不定",
                              124 ~ "非駕駛者 - 搶（闖）越平交道",
                              125 ~ "非駕駛者 - 事故發生時當事者逕自離開現場",
                              126 ~ "非駕駛者 - 開啟或關閉車門不當",
                              57 ~ "非駕駛者 - 頭手伸出車外",
                              58 ~ "非駕駛者 - 乘坐不當（慎）",
                              55 ~ "非駕駛者 - 未待車輛停妥而上下車",
                              56 ~ "非駕駛者 - 上下車輛時未注意安全",
                              59 ~ "非駕駛者 - 在道路上工作未設適當標識",
                              127 ~ "非駕駛者 - 指揮不當(包括未依法令授權)",
                              60 ~ "非駕駛者 - 其他引起事故之疏失或行為",
                              
                              64 ~ "交通管制(設施) - 平交道看守疏失或未放柵欄",
                              61 ~ "交通管制(設施) - 路況危險無安全（警告）設施",
                              128 ~ "交通管制(設施) - 施工安全防護措施未依規定或未盡完善（備）",
                              62 ~ "交通管制(設施) - 交通管制設施失靈或損毀",
                              65 ~ "交通管制(設施) - 其他交通管制不當",
                              
                              129 ~ "無（物或動物） - 道路設施（備）、植栽或其他裝置，倒塌或掉（斷）落",
                              130 ~ "無（物或動物） - 物品（件）滾（滑行）或飛（掉）落",
                              131 ~ "無（物或動物） - 強風、暴雨、濃霧（煙）",
                              66 ~ "無（物或動物） - 動物竄出",
                              67 ~ "無（物或動物） - 尚未發現肇事因素"
        ),
        
        
        
        
        # chatgpt generated...need to double check:
        肇因碼_主要 = case_match(`肇因碼-主要`,
                              1 ~ "駕駛者 - 違規超車",
                              2 ~ "駕駛者 - 爭(搶)道行駛",
                              68 ~ "駕駛者 - 危險駕駛",
                              4 ~ "駕駛者 - 逆向行駛",
                              13 ~ "駕駛者 - 超速駕駛",
                              14 ~ "駕駛者 - 未依規定減速",
                              16 ~ "駕駛者 - 未保持行車安全距離",
                              17 ~ "駕駛者 - 未保持行車安全間隔",
                              69 ~ "駕駛者 - 未遵守依法令授權交通指揮人員之指揮",
                              70 ~ "駕駛者 - 車輛未依規定暫停讓行人先行",
                              71 ~ "駕駛者 - 有號誌路口，轉彎車未讓直行車先行",
                              72 ~ "駕駛者 - 無號誌路口，支線道未讓幹線道先行",
                              73 ~ "駕駛者 - 無號誌路口，少線道未讓多線道先行",
                              74 ~ "駕駛者 - 無號誌路口，轉彎車未讓直行車先行",
                              75 ~ "駕駛者 - 無號誌路口，左方車未讓右方車先行",
                              76 ~ "駕駛者 - 山路會車，靠山壁車未讓外緣車先行",
                              77 ~ "駕駛者 - 峻狹坡路會車，下坡車未讓上坡車先行",
                              78 ~ "駕駛者 - 行經圓環未依規定讓車",
                              79 ~ "駕駛者 - 未依規定避讓消防、救護、警備、工程救險車、毒性化學物質災害事故應變車等執行緊急任務車",
                              80 ~ "駕駛者 - 其他未依規定讓車",
                              81 ~ "駕駛者 - 闖紅燈直行",
                              82 ~ "駕駛者 - 闖紅燈右轉",
                              83 ~ "駕駛者 - 闖紅燈左轉（或迴轉）",
                              84 ~ "駕駛者 - 違反閃光號誌",
                              85 ~ "駕駛者 - 違反其他號誌",
                              86 ~ "駕駛者 - 違反遵行方向標誌（線）",
                              87 ~ "駕駛者 - 違反車輛專用標誌（線）",
                              88 ~ "駕駛者 - 違反行人專用標誌（線）",
                              89 ~ "駕駛者 - 違反禁止進入標誌",
                              90 ~ "駕駛者 - 違反禁止各種車輛進入標誌",
                              91 ~ "駕駛者 - 違反禁止會車標誌",
                              92 ~ "駕駛者 - 違反禁止迴轉或迴車標誌",
                              93 ~ "駕駛者 - 違反車輛改道標誌",
                              94 ~ "駕駛者 - 違反禁止超車標誌（線）",
                              95 ~ "駕駛者 - 違反禁止變換車道標線",
                              96 ~ "駕駛者 - 違反二段式左（右）轉標誌（線）",
                              97 ~ "駕駛者 - 違反禁行車種標誌（字）",
                              98 ~ "駕駛者 - 違反禁止左轉、右轉標誌",
                              99 ~ "駕駛者 - 違反其他標誌（線）禁制",
                              100 ~ "駕駛者 - 變換車道不當",
                              5 ~ "駕駛者 - 未靠右行駛",
                              101 ~ "駕駛者 - 方向不定（不包括危險駕車）",
                              102 ~ "駕駛者 - 閃避不當（慎）",
                              103 ~ "駕駛者 - 多車道迴轉，未先駛入內側車道",
                              10 ~ "駕駛者 - 迴轉未依規定",
                              11 ~ "駕駛者 - 橫越道路不慎",
                              9 ~ "駕駛者 - 右轉彎未依規定",
                              8 ~ "駕駛者 - 左轉彎未依規定",
                              12 ~ "駕駛者 - 倒車未依規定",
                              18 ~ "駕駛者 - 停車操作時未注意安全",
                              19 ~ "駕駛者 - 起步時未注意安全",
                              20 ~ "駕駛者 - 吸食違禁物駕駛",
                              21 ~ "駕駛者 - 酒醉（後）駕駛",
                              22 ~ "駕駛者 - 患病或服用藥物（疲勞）駕駛",
                              104 ~ "駕駛者 - 打瞌睡或疲勞駕駛（包括連續駕車8小時）",
                              105 ~ "駕駛者 - 飲食、抽（點）菸、拿（撿）物品分心駕駛",
                              106 ~ "駕駛者 - 乘客、車上動（生）物干擾分心駕駛",
                              107 ~ "駕駛者 - 觀看其他事故、活動、道路環境或車外資訊分心駕駛",
                              108 ~ "駕駛者 - 恍神、緊張、心不在焉分心駕駛",
                              109 ~ "駕駛者 - 使用車輛自動駕駛或先進駕駛輔助系統設備（裝置）不符規定",
                              110 ~ "駕駛者 - 操作、觀看行車輔助或娛樂性顯示設備",
                              111 ~ "駕駛者 - 使用手持行動電話",
                              24 ~ "駕駛者 - 搶（闖）越平交道",
                              112 ~ "駕駛者 - 未保持平交道淨空",
                              
                              27 ~ "燈光 - 未依規定使用燈光",
                              28 ~ "燈光 - 暗處停車無燈光、標識",
                              29 ~ "燈光 - 夜間行駛無燈光設備",
                              
                              30 ~ "裝載 - 裝載貨物不穩妥",
                              31 ~ "裝載 - 載運貨物超重",
                              32 ~ "裝載 - 超載人員",
                              33 ~ "裝載 - 載運貨物超長、寬、高",
                              34 ~ "裝載 - 裝卸貨物不當",
                              35 ~ "裝載 - 裝載未盡安全措施",
                              36 ~ "裝載 - 未待乘客安全上下而開車",
                              37 ~ "裝載 - 其他裝載不當",
                              
                              40 ~ "其他 - 開啟或關閉車門不當",
                              38 ~ "其他 - 違規（臨時）停車",
                              113 ~ "其他 - 車輛未停妥滑動致生事故",
                              39 ~ "其他 - 車輛拋錨未採安全措施",
                              114 ~ "其他 - 發生事故後未採取安全措施",
                              115 ~ "其他 - 被車輛輾壓之不明物體彈飛",
                              116 ~ "其他 - 車輛或機械操作不當（慎）",
                              117 ~ "其他 - 因光線、視線遮蔽致生事故",
                              42 ~ "其他 - 其他不當駕車行為",
                              118 ~ "其他 - 相關跡證不足且無具體影像畫面，當事人各執一詞，經分析後無法釐清肇事原因",
                              119 ~ "其他 - 肇事逃逸未查獲，無法查明肇因",
                              
                              44 ~ "無（車輛駕駛者因素） - 尚未發現肇事因素",
                              
                              45 ~ "機件 - 煞車失靈或故障",
                              46 ~ "機件 - 方向操縱系統故障",
                              48 ~ "機件 - 車輪脫落或輪胎爆裂",
                              49 ~ "機件 - 車輛零件脫落",
                              47 ~ "機件 - 燈光系統故障",
                              120 ~ "機件 - 車輛附屬機具未盡安全措施",
                              50 ~ "機件 - 其他機件失靈或故障",
                              
                              121 ~ "非駕駛者 - 未依標誌或標線穿越道路",
                              122 ~ "非駕駛者 - 未依號誌或手勢指揮（示）穿越道路",
                              123 ~ "非駕駛者 - 未依規定行走地下道、天橋穿越道路",
                              53 ~ "非駕駛者 - 穿越道路未注意左右來車",
                              54 ~ "非駕駛者 - 在道路上嬉戲或奔走不定",
                              124 ~ "非駕駛者 - 搶（闖）越平交道",
                              125 ~ "非駕駛者 - 事故發生時當事者逕自離開現場",
                              126 ~ "非駕駛者 - 開啟或關閉車門不當",
                              57 ~ "非駕駛者 - 頭手伸出車外",
                              58 ~ "非駕駛者 - 乘坐不當（慎）",
                              55 ~ "非駕駛者 - 未待車輛停妥而上下車",
                              56 ~ "非駕駛者 - 上下車輛時未注意安全",
                              59 ~ "非駕駛者 - 在道路上工作未設適當標識",
                              127 ~ "非駕駛者 - 指揮不當(包括未依法令授權)",
                              60 ~ "非駕駛者 - 其他引起事故之疏失或行為",
                              
                              64 ~ "交通管制(設施) - 平交道看守疏失或未放柵欄",
                              61 ~ "交通管制(設施) - 路況危險無安全（警告）設施",
                              128 ~ "交通管制(設施) - 施工安全防護措施未依規定或未盡完善（備）",
                              62 ~ "交通管制(設施) - 交通管制設施失靈或損毀",
                              65 ~ "交通管制(設施) - 其他交通管制不當",
                              
                              129 ~ "無（物或動物） - 道路設施（備）、植栽或其他裝置，倒塌或掉（斷）落",
                              130 ~ "無（物或動物） - 物品（件）滾（滑行）或飛（掉）落",
                              131 ~ "無（物或動物） - 強風、暴雨、濃霧（煙）",
                              66 ~ "無（物或動物） - 動物竄出",
                              67 ~ "無（物或動物） - 尚未發現肇事因素"
        ),
        
        
        個人肇逃否 = case_match(個人肇逃否,
                        1 ~ "否",
                        2 ~ "是"),
        
        
        
        職業 = case_match(職業,
                        1 ~ "民意代表、行政主管、企業主管及經理人員",
                        2 ~ "專業人員",
                        3 ~ "技術員及助理人員",
                        4 ~ "事務工作者", 
                        5 ~ "服務工作者",
                        6 ~ "售貨員",
                        7 ~ "農林漁牧工作者",
                        8 ~ "保安工作者(不含警察人員)", 
                        9 ~ "技術工",
                        10 ~ "汽車、火車駕駛員及船員",
                        11 ~ "機械設備操作工及組裝工",
                        12 ~ "非技術工及體力工",
                        13 ~ "未就學兒童", 
                        14 ~ "小學生（1-6 年級）",
                        15 ~ "國中生（7-9 年級）",
                        16 ~ "高中（職）生",
                        17 ~ "專科生",
                        18 ~ "大學(研究)生",
                        19 ~ "家庭主婦(夫)",
                        20 ~ "無業者",
                        21 ~ "其他",
                        22 ~ "不明",
                        23 ~ "警察人員",
                        24 ~ "6 歲以下嬰幼童",
                        25 ~ "大學生（專科、院校、研究所）", 
                        26 ~ "勞工人員"),
        
        
        
        旅次目的 = case_match(旅次目的, 
                             1 ~ "上、下班",
                             2 ~ "上、下學",
                             3 ~ "業務聯繫",
                             4 ~ "運輸", 
                             5 ~ "社交活動",
                             6 ~ "觀光旅遊",
                             7 ~ "購物",
                             8 ~ "其他", 
                             9 ~ "不明"),
        
      
         
         
         
         ) |>
  
  # select only the columns we want
  select(發生日期,
         發生年度,
         發生月,
         發生日,
         發生時_Hours = `發生時-Hours`,
         發生分,
         處理別_編號 = `處理別-編號`,
         區序,
         肇事地點,
         死亡人數,
         受傷人數,
         當事人序號,
         車種,
         性別,
         年齡,
         受傷程度,
         天候,
         速限_速度限制 = `速限-速度限制`,
         道路型態,
         事故位置,
         
         座標_X = `座標-X`,
         座標_Y = `座標-Y`,
         
         後_2_30日死亡人數 = `2-30日死亡人數`,
         光線,
         道路照明設備,
         道路類別,
         
         路面鋪裝,
         路面狀態,
         路面缺陷,
         
         道路障礙_障礙物,
         道路障礙_視距,
         
         號誌種類,
         號誌動作,
         
         車道劃分_分向,
         車道劃分_快車道或一般車道間,
         車道劃分_快慢車道間,
         車道劃分_路面邊線,
         
         事故類型及型態,
         主要傷處,
         
         保護裝置,
         安全帽,
         
         行動電話,
         車輛用途,
         當事者行動狀態,
         駕駛資格情形,
         駕駛執照種類,
         飲酒情形,
         
         車輛撞擊部位1,
         車輛撞擊部位2,
         
         肇因碼_個別,
         肇因碼_主要,
         
         個人肇逃否,
         職業,
         旅次目的
         
)


